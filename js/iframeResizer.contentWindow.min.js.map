{"version":3,"file":"iframeResizer.contentWindow.min.js","sources":["../src/iframeResizer.contentWindow.js"],"sourcesContent":["/*\n * File: iframeResizer.contentWindow.js\n * Desc: Include this file in any page being loaded into an iframe\n *       to force the iframe to resize to the content size.\n * Requires: iframeResizer.js on host page.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n *\n */\n\n// eslint-disable-next-line sonarjs/cognitive-complexity, no-shadow-restricted-names\n;(function (undefined) {\n  if (typeof window === 'undefined') return // don't run for server side render\n\n  const BASE = 10\n  const SINGLE = 1\n  const SIZE_ATTR = 'data-iframe-size'\n\n  const checkVisibilityOptions = {\n    contentVisibilityAuto: true,\n    opacityProperty: true,\n    visibilityProperty: true\n  }\n  const customCalcMethods = {\n    height: () => {\n      warn('Custom height calculation function not defined')\n      return getHeight.auto()\n    },\n    width: () => {\n      warn('Custom width calculation function not defined')\n      return getWidth.auto()\n    }\n  }\n  const deprecatedResizeMethods = {\n    bodyOffset: 1,\n    bodyScroll: 1,\n    offset: 1,\n    documentElementOffset: 1,\n    documentElementScroll: 1,\n    documentElementBoundingClientRect: 1,\n    max: 1,\n    min: 1,\n    grow: 1,\n    lowestElement: 1\n  }\n  // const doubleEventList = { resize: 1, click: 1 }\n  const eventCancelTimer = 128\n  const eventHandlersByName = {}\n  const hasCheckVisibility = 'checkVisibility' in window\n  const heightCalcModeDefault = 'auto'\n  const nonLoggableTriggerEvents = { reset: 1, resetPage: 1, init: 1 }\n  const msgID = '[iFrameSizer]' // Must match host page msg ID\n  const msgIdLen = msgID.length\n  const resetRequiredMethods = {\n    max: 1,\n    min: 1,\n    bodyScroll: 1,\n    documentElementScroll: 1\n  }\n  const resizeObserveTargets = ['body']\n  const sendPermit = true\n  const widthCalcModeDefault = 'scroll'\n\n  let autoResize = true\n  let bodyBackground = ''\n  let bodyMargin = 0\n  let bodyMarginStr = ''\n  let bodyObserver = null\n  let bodyPadding = ''\n  let calculateHeight = true\n  let calculateWidth = false\n  let calcElements = null\n  let firstRun = true\n  let hasTags = false\n  let height = 1\n  let heightCalcMode = heightCalcModeDefault // only applys if not provided by host page (V1 compatibility)\n  let initLock = true\n  let initMsg = ''\n  let inPageLinks = {}\n  let isInit = true\n  let logging = false\n  let mouseEvents = false\n  let myID = ''\n  let offsetHeight = 0\n  let offsetWidth = 0\n  let resizeFrom = 'child'\n  let resizeObserver = null\n  let sameDomian = false\n  let target = window.parent\n  let targetOriginDefault = '*'\n  let tolerance = 0\n  let triggerLocked = false\n  let width = 1\n  let widthCalcMode = widthCalcModeDefault\n  let win = window\n\n  let onMessage = () => {\n    warn('onMessage function not defined')\n  }\n  let onReady = () => {}\n  let onPageInfo = null\n\n  const addEventListener = (el, evt, func, options) =>\n    el.addEventListener(evt, func, options || {})\n\n  const removeEventListener = (el, evt, func) =>\n    el.removeEventListener(evt, func, false)\n\n  const capitalizeFirstLetter = (string) =>\n    string.charAt(0).toUpperCase() + string.slice(1)\n\n  const isDef = (value) => `${value}` !== '' && value !== undefined\n\n  function getElementName(el) {\n    switch (true) {\n      case !isDef(el):\n        return ''\n\n      case isDef(el.id):\n        return `${el.nodeName.toUpperCase()}#${el.id}`\n\n      case isDef(el.name):\n        return `${el.nodeName.toUpperCase()} (${el.name})`\n\n      default:\n        return (\n          el.nodeName.toUpperCase() +\n          (isDef(el.className) ? `.${el.className}` : '')\n        )\n    }\n  }\n\n  function elementSnippet(el) {\n    const outer = el?.outerHTML?.toString()\n\n    if (!outer) return el\n\n    return outer.length < 30\n      ? outer\n      : `${outer.slice(0, 30).replaceAll('\\n', ' ')}...`\n  }\n\n  // TODO: remove .join(' '), requires major test updates\n  const formatLogMsg = (...msg) => [`${msgID}[${myID}]`, ...msg].join(' ')\n\n  const log = (...msg) =>\n    // eslint-disable-next-line no-console\n    logging && window.console && console.log(formatLogMsg(...msg))\n\n  const warn = (...msg) =>\n    // eslint-disable-next-line no-console\n    window.console && console.warn(formatLogMsg(...msg))\n\n  const advise = (...msg) =>\n    // eslint-disable-next-line no-console\n    window.console &&\n    // eslint-disable-next-line no-console\n    console.warn(\n      window.chrome // Only show formatting in Chrome as not supported in other browsers\n        ? formatLogMsg(...msg)\n        : formatLogMsg(...msg).replaceAll(/\\u001B\\[[\\d;]*m/gi, '') // eslint-disable-line no-control-regex\n    )\n\n  function init() {\n    checkCrossDomain()\n    readDataFromParent()\n    log(`Initialising iFrame (${window.location.href})`)\n    readDataFromPage()\n    setMargin()\n    setBodyStyle('background', bodyBackground)\n    setBodyStyle('padding', bodyPadding)\n    injectClearFixIntoBodyElement()\n    stopInfiniteResizingOfIFrame()\n    checkHeightMode()\n    checkWidthMode()\n    checkDeprecatedAttrs()\n    checkHasDataSizeAttributes()\n    setupCalcElements()\n    setupPublicMethods()\n    setupMouseEvents()\n    startEventListeners()\n    inPageLinks = setupInPageLinks()\n    sendSize('init', 'Init message from host page')\n    onReady()\n    isInit = false\n  }\n\n  function checkCrossDomain() {\n    try {\n      sameDomian = 'iFrameListener' in window.parent\n    } catch (error) {\n      log('Cross domain iframe detected.')\n    }\n  }\n\n  function readDataFromParent() {\n    const strBool = (str) => str === 'true'\n    const data = initMsg.slice(msgIdLen).split(':')\n\n    myID = data[0] // eslint-disable-line prefer-destructuring\n    bodyMargin = undefined === data[1] ? bodyMargin : Number(data[1]) // For V1 compatibility\n    calculateWidth = undefined === data[2] ? calculateWidth : strBool(data[2])\n    logging = undefined === data[3] ? logging : strBool(data[3])\n    // data[4] no longer used (was intervalTimer)\n    autoResize = undefined === data[6] ? autoResize : strBool(data[6])\n    bodyMarginStr = data[7] // eslint-disable-line prefer-destructuring\n    heightCalcMode = undefined === data[8] ? heightCalcMode : data[8]\n    bodyBackground = data[9] // eslint-disable-line prefer-destructuring\n    bodyPadding = data[10] // eslint-disable-line prefer-destructuring\n    tolerance = undefined === data[11] ? tolerance : Number(data[11])\n    inPageLinks.enable = undefined === data[12] ? false : strBool(data[12])\n    resizeFrom = undefined === data[13] ? resizeFrom : data[13]\n    widthCalcMode = undefined === data[14] ? widthCalcMode : data[14]\n    mouseEvents = undefined === data[15] ? mouseEvents : strBool(data[15])\n    offsetHeight = undefined === data[16] ? offsetHeight : Number(data[16])\n    offsetWidth = undefined === data[17] ? offsetWidth : Number(data[17])\n    calculateHeight =\n      undefined === data[18] ? calculateHeight : strBool(data[18])\n  }\n\n  function readDataFromPage() {\n    function readData() {\n      const data = window.iFrameResizer\n\n      log(`Reading data from page: ${JSON.stringify(data)}`)\n\n      onMessage = data?.onMessage || onMessage\n      onReady = data?.onReady || onReady\n      offsetHeight = data?.offsetHeight || offsetHeight\n      offsetWidth = data?.offsetWidth || offsetWidth\n      targetOriginDefault = data?.targetOrigin || targetOriginDefault\n      heightCalcMode = data?.heightCalculationMethod || heightCalcMode\n      widthCalcMode = data?.widthCalculationMethod || widthCalcMode\n    }\n\n    function setupCustomCalcMethods(calcMode, calcFunc) {\n      if (typeof calcMode === 'function') {\n        log(`Setup custom ${calcFunc}CalcMethod`)\n        customCalcMethods[calcFunc] = calcMode\n        calcMode = 'custom'\n      }\n\n      return calcMode\n    }\n\n    if (\n      'iFrameResizer' in window &&\n      Object === window.iFrameResizer.constructor\n    ) {\n      readData()\n      heightCalcMode = setupCustomCalcMethods(heightCalcMode, 'height')\n      widthCalcMode = setupCustomCalcMethods(widthCalcMode, 'width')\n    }\n\n    log(`TargetOrigin for parent set to: ${targetOriginDefault}`)\n  }\n\n  function chkCSS(attr, value) {\n    if (value.includes('-')) {\n      warn(`Negative CSS value ignored for ${attr}`)\n      value = ''\n    }\n\n    return value\n  }\n\n  function setBodyStyle(attr, value) {\n    if (undefined !== value && value !== '' && value !== 'null') {\n      document.body.style.setProperty(attr, value)\n      log(`Body ${attr} set to \"${value}\"`)\n    }\n  }\n\n  function setMargin() {\n    // If called via V1 script, convert bodyMargin from int to str\n    if (undefined === bodyMarginStr) {\n      bodyMarginStr = `${bodyMargin}px`\n    }\n\n    setBodyStyle('margin', chkCSS('margin', bodyMarginStr))\n  }\n\n  function stopInfiniteResizingOfIFrame() {\n    const setAutoHeight = (el) =>\n      el.style.setProperty('height', 'auto', 'important')\n\n    setAutoHeight(document.documentElement)\n    setAutoHeight(document.body)\n\n    log('HTML & body height set to \"auto !important\"')\n  }\n\n  function manageTriggerEvent(options) {\n    const listener = {\n      add(eventName) {\n        function handleEvent() {\n          sendSize(options.eventName, options.eventType)\n        }\n\n        eventHandlersByName[eventName] = handleEvent\n\n        addEventListener(window, eventName, handleEvent, { passive: true })\n      },\n      remove(eventName) {\n        const handleEvent = eventHandlersByName[eventName]\n        delete eventHandlersByName[eventName]\n\n        removeEventListener(window, eventName, handleEvent)\n      }\n    }\n\n    listener[options.method](options.eventName)\n\n    log(\n      `${capitalizeFirstLetter(options.method)} event listener: ${\n        options.eventType\n      }`\n    )\n  }\n\n  function manageEventListeners(method) {\n    manageTriggerEvent({\n      method,\n      eventType: 'After Print',\n      eventName: 'afterprint'\n    })\n\n    manageTriggerEvent({\n      method,\n      eventType: 'Before Print',\n      eventName: 'beforeprint'\n    })\n\n    manageTriggerEvent({\n      method,\n      eventType: 'Ready State Change',\n      eventName: 'readystatechange'\n    })\n\n    //   manageTriggerEvent({\n    //     method: method,\n    //     eventType: 'Orientation Change',\n    //     eventName: 'orientationchange'\n    //   })\n  }\n\n  function checkDeprecatedAttrs() {\n    let found = false\n\n    const checkAttrs = (attr) =>\n      document.querySelectorAll(`[${attr}]`).forEach((el) => {\n        found = true\n        el.removeAttribute(attr)\n        el.setAttribute(SIZE_ATTR, null)\n      })\n\n    checkAttrs('data-iframe-height')\n    checkAttrs('data-iframe-width')\n\n    if (found) {\n      advise(`\n\\u001B[31;1mDeprecated Attributes\\u001B[m\n          \nThe \\u001B[1mdata-iframe-height\\u001B[m and \\u001B[1mdata-iframe-width\\u001B[m attributes have been deprecated and replaced with the single \\u001B[1mdata-iframe-size\\u001B[m attribute. Use of the old attributes will be removed in a future version of \\u001B[3miframe-resizer\\u001B[m.`)\n    }\n  }\n\n  function checkHasDataSizeAttributes() {\n    if (document.querySelectorAll(`[${SIZE_ATTR}]`).length > 0) {\n      if (heightCalcMode === 'auto') {\n        heightCalcMode = 'autoOverflow'\n        log(\n          'data-iframe-size attribute found on page, using \"autoOverflow\" calculation method for height'\n        )\n      }\n      if (widthCalcMode === 'auto') {\n        widthCalcMode = 'autoOverflow'\n        log(\n          'data-iframe-size attribute found on page, using \"autoOverflow\" calculation method for width'\n        )\n      }\n    }\n  }\n\n  function setupCalcElements() {\n    const taggedElements = document.querySelectorAll(`[${SIZE_ATTR}]`)\n    hasTags = taggedElements.length > 0\n    calcElements = hasTags ? taggedElements : getAllElements(document)()\n  }\n\n  function checkCalcMode(calcMode, calcModeDefault, modes, type) {\n    if (calcModeDefault !== calcMode) {\n      if (!(calcMode in modes)) {\n        warn(`${calcMode} is not a valid option for ${type}CalculationMethod.`)\n        calcMode = calcModeDefault\n      }\n      if (calcMode in deprecatedResizeMethods) {\n        advise(`\n\\u001B[31;1mDeprecated ${type}CalculationMethod (${calcMode})\\u001B[m\n\nThis version of \\u001B[3miframe-resizer\\u001B[m can auto detect the most suitable ${type} calculation method. It is recommended that you remove this option.`)\n      }\n      log(`${type} calculation method set to \"${calcMode}\"`)\n    }\n\n    return calcMode\n  }\n\n  function checkHeightMode() {\n    heightCalcMode = checkCalcMode(\n      heightCalcMode,\n      heightCalcModeDefault,\n      getHeight,\n      'height'\n    )\n  }\n\n  function checkWidthMode() {\n    widthCalcMode = checkCalcMode(\n      widthCalcMode,\n      widthCalcModeDefault,\n      getWidth,\n      'width'\n    )\n  }\n\n  function startEventListeners() {\n    if (autoResize !== true) {\n      log('Auto Resize disabled')\n      return\n    }\n\n    manageEventListeners('add')\n    setupMutationObserver()\n    setupResizeObserver()\n  }\n\n  function stopEventListeners() {\n    manageEventListeners('remove')\n    resizeObserver?.disconnect()\n    bodyObserver?.disconnect()\n  }\n\n  function injectClearFixIntoBodyElement() {\n    const clearFix = document.createElement('div')\n\n    clearFix.style.clear = 'both'\n    // Guard against the following having been globally redefined in CSS.\n    clearFix.style.display = 'block'\n    clearFix.style.height = '0'\n    document.body.append(clearFix)\n  }\n\n  function setupInPageLinks() {\n    const getPagePosition = () => ({\n      x: document.documentElement.scrollLeft,\n      y: document.documentElement.scrollTop\n    })\n\n    function getElementPosition(el) {\n      const elPosition = el.getBoundingClientRect()\n      const pagePosition = getPagePosition()\n\n      return {\n        x: parseInt(elPosition.left, BASE) + parseInt(pagePosition.x, BASE),\n        y: parseInt(elPosition.top, BASE) + parseInt(pagePosition.y, BASE)\n      }\n    }\n\n    function findTarget(location) {\n      function jumpToTarget(target) {\n        const jumpPosition = getElementPosition(target)\n\n        log(\n          `Moving to in page link (#${hash}) at x: ${jumpPosition.x}y: ${jumpPosition.y}`\n        )\n\n        sendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset') // X&Y reversed at sendMsg uses height/width\n      }\n\n      const hash = location.split('#')[1] || location // Remove # if present\n      const hashData = decodeURIComponent(hash)\n      const target =\n        document.getElementById(hashData) ||\n        document.getElementsByName(hashData)[0]\n\n      if (target !== undefined) {\n        jumpToTarget(target)\n        return\n      }\n\n      log(`In page link (#${hash}) not found in iFrame, so sending to parent`)\n      sendMsg(0, 0, 'inPageLink', `#${hash}`)\n    }\n\n    function checkLocationHash() {\n      const { hash, href } = window.location\n\n      if (hash !== '' && hash !== '#') {\n        findTarget(href)\n      }\n    }\n\n    function bindAnchors() {\n      function setupLink(el) {\n        function linkClicked(e) {\n          e.preventDefault()\n\n          findTarget(this.getAttribute('href'))\n        }\n\n        if (el.getAttribute('href') !== '#') {\n          addEventListener(el, 'click', linkClicked)\n        }\n      }\n\n      document.querySelectorAll('a[href^=\"#\"]').forEach(setupLink)\n    }\n\n    function bindLocationHash() {\n      addEventListener(window, 'hashchange', checkLocationHash)\n    }\n\n    function initCheck() {\n      // Check if page loaded with location hash after init resize\n      setTimeout(checkLocationHash, eventCancelTimer)\n    }\n\n    function enableInPageLinks() {\n      /* istanbul ignore else */ // Not testable in phantonJS\n      log('Setting up location.hash handlers')\n      bindAnchors()\n      bindLocationHash()\n      initCheck()\n    }\n\n    if (inPageLinks.enable) {\n      enableInPageLinks()\n    } else {\n      log('In page linking not enabled')\n    }\n\n    return {\n      findTarget\n    }\n  }\n\n  function setupMouseEvents() {\n    if (mouseEvents !== true) return\n\n    function sendMouse(e) {\n      sendMsg(0, 0, e.type, `${e.screenY}:${e.screenX}`)\n    }\n\n    function addMouseListener(evt, name) {\n      log(`Add event listener: ${name}`)\n      addEventListener(window.document, evt, sendMouse)\n    }\n\n    addMouseListener('mouseenter', 'Mouse Enter')\n    addMouseListener('mouseleave', 'Mouse Leave')\n  }\n\n  function setupPublicMethods() {\n    win.parentIFrame = {\n      autoResize: (resize) => {\n        if (resize === true && autoResize === false) {\n          autoResize = true\n          startEventListeners()\n        } else if (resize === false && autoResize === true) {\n          autoResize = false\n          stopEventListeners()\n        }\n\n        sendMsg(0, 0, 'autoResize', JSON.stringify(autoResize))\n\n        return autoResize\n      },\n\n      close() {\n        sendMsg(0, 0, 'close')\n      },\n\n      getId: () => myID,\n\n      getPageInfo(callback) {\n        if (typeof callback === 'function') {\n          onPageInfo = callback\n          sendMsg(0, 0, 'pageInfo')\n          return\n        }\n\n        onPageInfo = null\n        sendMsg(0, 0, 'pageInfoStop')\n      },\n\n      moveToAnchor(hash) {\n        inPageLinks.findTarget(hash)\n      },\n\n      reset() {\n        resetIFrame('parentIFrame.reset')\n      },\n\n      scrollTo(x, y) {\n        sendMsg(y, x, 'scrollTo') // X&Y reversed at sendMsg uses height/width\n      },\n\n      scrollToOffset(x, y) {\n        sendMsg(y, x, 'scrollToOffset') // X&Y reversed at sendMsg uses height/width\n      },\n\n      sendMessage(msg, targetOrigin) {\n        sendMsg(0, 0, 'message', JSON.stringify(msg), targetOrigin)\n      },\n\n      setHeightCalculationMethod(heightCalculationMethod) {\n        heightCalcMode = heightCalculationMethod\n        checkHeightMode()\n      },\n\n      setWidthCalculationMethod(widthCalculationMethod) {\n        widthCalcMode = widthCalculationMethod\n        checkWidthMode()\n      },\n\n      setTargetOrigin(targetOrigin) {\n        log(`Set targetOrigin: ${targetOrigin}`)\n        targetOriginDefault = targetOrigin\n      },\n\n      size(customHeight, customWidth) {\n        const valString = `${customHeight || ''}${customWidth ? `,${customWidth}` : ''}`\n\n        sendSize(\n          'size',\n          `parentIFrame.size(${valString})`,\n          customHeight,\n          customWidth\n        )\n      }\n    }\n  }\n\n  function resizeObserved(entries) {\n    const el = entries[0].target\n    sendSize('resizeObserver', `resizeObserver: ${getElementName(el)}`)\n  }\n\n  const checkPositionType = (element) => {\n    const style = getComputedStyle(element)\n    return style?.position !== '' && style?.position !== 'static'\n  }\n\n  const getAllNonStaticElements = () =>\n    [...getAllElements(document)()].filter(checkPositionType)\n\n  function setupResizeObservers(el) {\n    if (!el) return\n    resizeObserver.observe(el)\n    log(`Attached resizeObserver: ${getElementName(el)}`)\n  }\n\n  function createResizeObservers(el) {\n    ;[\n      ...getAllNonStaticElements(),\n      ...resizeObserveTargets.flatMap((target) => el.querySelector(target))\n    ].forEach(setupResizeObservers)\n  }\n\n  function addResizeObservers(mutation) {\n    if (mutation.type === 'childList') {\n      createResizeObservers(mutation.target)\n    }\n  }\n\n  function setupResizeObserver() {\n    resizeObserver = new ResizeObserver(resizeObserved)\n    createResizeObservers(window.document)\n  }\n\n  function setupBodyMutationObserver() {\n    function mutationObserved(mutations) {\n      // Look for injected elements that need ResizeObservers\n      mutations.forEach(addResizeObservers)\n\n      // Rebuild elements list for size calculation\n      setupCalcElements()\n    }\n\n    function createMutationObserver() {\n      const observer = new window.MutationObserver(mutationObserved)\n      const target = document.querySelector('body')\n      const config = {\n        // attributes: true,\n        attributes: false,\n        attributeOldValue: false,\n        // characterData: true,\n        characterData: false,\n        characterDataOldValue: false,\n        childList: true,\n        subtree: true\n      }\n\n      log('Create <body/> MutationObserver')\n      observer.observe(target, config)\n\n      return observer\n    }\n\n    const observer = createMutationObserver()\n\n    return {\n      disconnect() {\n        log('Disconnect MutationObserver')\n        observer.disconnect()\n      }\n    }\n  }\n\n  function setupMutationObserver() {\n    bodyObserver = setupBodyMutationObserver()\n  }\n\n  // Idea from https://github.com/guardian/iframe-messenger\n  function getMaxElement(side) {\n    const Side = capitalizeFirstLetter(side)\n\n    let elVal = 0\n    let len = calcElements.length\n    let maxEl\n    let maxVal = 0\n    let timer = performance.now()\n\n    calcElements.forEach((element) => {\n      if (\n        !hasTags &&\n        hasCheckVisibility &&\n        !element.checkVisibility(checkVisibilityOptions)\n      ) {\n        log(`Skipping non-visable element: ${getElementName(element)}`)\n        len -= 1\n        return\n      }\n\n      elVal =\n        element.getBoundingClientRect()[side] +\n        getComputedStyle(element).getPropertyValue(`margin${Side}`)\n\n      if (elVal > maxVal) {\n        maxVal = elVal\n        maxEl = element\n      }\n    })\n\n    timer = performance.now() - timer\n\n    const logMsg = `\nParsed ${len} element${(len = SINGLE ? '' : 's')} in ${timer.toPrecision(3)}ms\n${Side} ${hasTags ? 'tagged' : ''} element found at: ${maxVal}px\nPosition calculated from HTML element: ${elementSnippet(maxEl)}`\n\n    if (timer < 1.1 || isInit || hasTags) {\n      log(logMsg)\n    } else {\n      advise(\n        `\n\\u001B[31;1mPerformance Warning\\u001B[m\n\nCalculateing the page size took an excessive amount of time. To improve performace add the \\u001B[1mdata-iframe-size\\u001B[m attribute to the ${side} element on the page.\n${logMsg}`\n      )\n    }\n    return maxVal\n  }\n\n  const getAllMeasurements = (dimension) => [\n    dimension.bodyOffset(),\n    dimension.bodyScroll(),\n    dimension.documentElementOffset(),\n    dimension.documentElementScroll(),\n    dimension.documentElementBoundingClientRect()\n  ]\n\n  const getAllElements = (element) => () =>\n    element.querySelectorAll(\n      '* :not(head):not(meta):not(base):not(title):not(script):not(link):not(style):not(map):not(area):not(option):not(optgroup):not(template):not(track):not(wbr):not(nobr)'\n    )\n\n  function switchToAutoOverflow({\n    ceilBoundingSize,\n    dimension,\n    isHeight,\n    scrollSize\n  }) {\n    const furthest = isHeight ? 'lowest' : 'right most'\n    const side = isHeight ? 'bottom' : 'right'\n    const overflowDetectedMessage = `\n\\u001B[31;1mDetected content overflowing html element\\u001B[m\n    \nThis causes \\u001B[3miframe-resizer\\u001B[m to fall back to checking the position of every element on the page in order to calculate the correct dimensions of the iframe. Inspecting the size, ${side} margin, and position of every visable HTML element will have a performace impact on more complex pages. \n\nTo fix this issue, and remove this warning, you can either ensure the content of the page does not overflow the \\u001B[1m<HTML>\\u001B[m element or alternatively you can add the attribute \\u001B[1mdata-iframe-size\\u001B[m to the elements on the page that you want \\u001B[3miframe-resizer\\u001B[m to use when calculating the dimensions of the iframe. \n  \nWhen present the \\u001B[3m${side} margin of the ${furthest} element\\u001B[m with a \\u001B[1mdata-iframe-size\\u001B[m attribute will be used to set the ${dimension} of the iframe.\n    \n(Page size: ${scrollSize} > document size: ${ceilBoundingSize})`\n\n    advise(overflowDetectedMessage)\n\n    if (isHeight) {\n      log(`Switching from ${heightCalcMode} to autoOverflow`)\n      heightCalcMode = 'autoOverflow'\n    } else {\n      log(`Switching from ${widthCalcMode} to autoOverflow`)\n      widthCalcMode = 'autoOverflow'\n    }\n  }\n\n  const prevScrollSize = {\n    height: 0,\n    width: 0\n  }\n\n  const prevBoundingSize = {\n    height: 0,\n    width: 0\n  }\n\n  const getAdjustedScroll = (getDimension) =>\n    getDimension.documentElementScroll() + Math.max(0, getDimension.getOffset())\n\n  function getAutoSize(getDimension, autoOverflow) {\n    function returnBoundingClientRect() {\n      prevBoundingSize[dimension] = boundingSize\n      prevScrollSize[dimension] = scrollSize\n      return boundingSize\n    }\n\n    const isHeight = getDimension === getHeight\n    const dimension = isHeight ? 'height' : 'width'\n    const boundingSize = getDimension.documentElementBoundingClientRect()\n    const ceilBoundingSize = Math.ceil(boundingSize)\n    const floorBoundingSize = Math.floor(boundingSize)\n    const scrollSize = getAdjustedScroll(getDimension)\n    const sizes = `HTML: ${boundingSize}  Page: ${scrollSize}`\n\n    switch (true) {\n      case !getDimension.enabled():\n        return scrollSize\n\n      case !autoOverflow &&\n        prevBoundingSize[dimension] === 0 &&\n        prevScrollSize[dimension] === 0:\n        log(`Initial page size values: ${sizes}`)\n        if (getDimension.taggedElement(true) <= ceilBoundingSize) {\n          return returnBoundingClientRect()\n        }\n        break\n\n      case triggerLocked &&\n        boundingSize === prevBoundingSize[dimension] &&\n        scrollSize === prevScrollSize[dimension]:\n        log(`Size unchanged: ${sizes}`)\n        return Math.max(boundingSize, scrollSize)\n\n      case boundingSize === 0:\n        log(`Page is hidden: ${sizes}`)\n        return scrollSize\n\n      case !autoOverflow &&\n        boundingSize !== prevBoundingSize[dimension] &&\n        scrollSize <= prevScrollSize[dimension]:\n        log(\n          `New HTML bounding size: ${sizes}`,\n          'Previous bounding size:',\n          prevBoundingSize[dimension]\n        )\n        return returnBoundingClientRect()\n\n      case !autoOverflow && boundingSize < prevBoundingSize[dimension]:\n        log('HTML bounding size decreased:', sizes)\n        return returnBoundingClientRect()\n\n      case scrollSize === floorBoundingSize || scrollSize === ceilBoundingSize:\n        log('HTML bounding size equals page size:', sizes)\n        return returnBoundingClientRect()\n\n      case boundingSize > scrollSize:\n        log(`Page size < HTML bounding size: ${sizes}`)\n        return returnBoundingClientRect()\n\n      case !autoOverflow:\n        log(`Switch to autoOverflow: ${sizes}`)\n        switchToAutoOverflow({\n          ceilBoundingSize,\n          dimension,\n          isHeight,\n          scrollSize\n        })\n        break\n\n      default:\n        log(`Content overflowing HTML element: ${sizes}`)\n    }\n\n    return Math.max(getDimension.taggedElement(), returnBoundingClientRect())\n  }\n\n  const getBodyOffset = () => {\n    const { body } = document\n    const style = getComputedStyle(body)\n\n    return (\n      body.offsetHeight +\n      parseInt(style.marginTop, BASE) +\n      parseInt(style.marginBottom, BASE)\n    )\n  }\n\n  const getHeight = {\n    enabled: () => calculateHeight,\n    getOffset: () => offsetHeight,\n    type: 'height',\n    auto: () => getAutoSize(getHeight, false),\n    autoOverflow: () => getAutoSize(getHeight, true),\n    bodyOffset: getBodyOffset,\n    bodyScroll: () => document.body.scrollHeight,\n    offset: () => getHeight.bodyOffset(), // Backwards compatibility\n    custom: () => customCalcMethods.height(),\n    documentElementOffset: () => document.documentElement.offsetHeight,\n    documentElementScroll: () => document.documentElement.scrollHeight,\n    documentElementBoundingClientRect: () =>\n      document.documentElement.getBoundingClientRect().bottom,\n    max: () => Math.max(...getAllMeasurements(getHeight)),\n    min: () => Math.min(...getAllMeasurements(getHeight)),\n    grow: () => getHeight.max(),\n    lowestElement: () => getMaxElement('bottom'),\n    taggedElement: () => getMaxElement('bottom')\n  }\n\n  const getWidth = {\n    enabled: () => calculateWidth,\n    getOffset: () => offsetWidth,\n    type: 'width',\n    auto: () => getAutoSize(getWidth, false),\n    autoOverflow: () => getAutoSize(getWidth, true),\n    bodyScroll: () => document.body.scrollWidth,\n    bodyOffset: () => document.body.offsetWidth,\n    custom: () => customCalcMethods.width(),\n    documentElementScroll: () => document.documentElement.scrollWidth,\n    documentElementOffset: () => document.documentElement.offsetWidth,\n    documentElementBoundingClientRect: () =>\n      document.documentElement.getBoundingClientRect().right,\n    max: () => Math.max(...getAllMeasurements(getWidth)),\n    min: () => Math.min(...getAllMeasurements(getWidth)),\n    rightMostElement: () => getMaxElement('right'),\n    scroll: () =>\n      Math.max(getWidth.bodyScroll(), getWidth.documentElementScroll()),\n    taggedElement: () => getMaxElement('right')\n  }\n\n  function sizeIFrame(\n    triggerEvent,\n    triggerEventDesc,\n    customHeight,\n    customWidth\n  ) {\n    function resizeIFrame() {\n      height = currentHeight\n      width = currentWidth\n\n      // if (height === 0) {\n      //   log('Height is 0. Not sending a message to the parent page.')\n      //   return\n      // }\n\n      // if (width === 0) {\n      //   log('Width is 0. Not sending a message to the parent page.')\n      //   return\n      // }\n\n      sendMsg(height, width, triggerEvent)\n    }\n\n    function isSizeChangeDetected() {\n      const checkTolarance = (a, b) => !(Math.abs(a - b) <= tolerance)\n\n      currentHeight = Math.ceil(\n        undefined === customHeight ? getHeight[heightCalcMode]() : customHeight\n      )\n\n      currentWidth = Math.ceil(\n        undefined === customWidth ? getWidth[widthCalcMode]() : customWidth\n      )\n\n      return (\n        (calculateHeight && checkTolarance(height, currentHeight)) ||\n        (calculateWidth && checkTolarance(width, currentWidth))\n      )\n    }\n\n    const isForceResizableEvent = () => !(triggerEvent in { init: 1, size: 1 })\n\n    const isForceResizableCalcMode = () =>\n      (calculateHeight && heightCalcMode in resetRequiredMethods) ||\n      (calculateWidth && widthCalcMode in resetRequiredMethods)\n\n    function checkDownSizing() {\n      if (isForceResizableEvent() && isForceResizableCalcMode()) {\n        resetIFrame(triggerEventDesc)\n      }\n    }\n\n    let currentHeight\n    let currentWidth\n\n    if (isSizeChangeDetected() || triggerEvent === 'init') {\n      lockTrigger()\n      resizeIFrame()\n    } else {\n      checkDownSizing()\n    }\n  }\n\n  function sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth) {\n    if (document.hidden) {\n      // Currently only correctly supported in firefox\n      // This is checked again on the parent page\n      log('Page hidden - Ignored resize request')\n      return\n    }\n\n    if (!(triggerEvent in nonLoggableTriggerEvents)) {\n      log(`Trigger event: ${triggerEventDesc}`)\n    }\n\n    sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth)\n  }\n\n  function lockTrigger() {\n    if (triggerLocked) return\n\n    triggerLocked = true\n    log('Trigger event lock on')\n\n    requestAnimationFrame(() => {\n      triggerLocked = false\n      log('Trigger event lock off')\n      log('--')\n    })\n  }\n\n  function triggerReset(triggerEvent) {\n    height = getHeight[heightCalcMode]()\n    width = getWidth[widthCalcMode]()\n\n    sendMsg(height, width, triggerEvent)\n  }\n\n  function resetIFrame(triggerEventDesc) {\n    const hcm = heightCalcMode\n    heightCalcMode = heightCalcModeDefault\n\n    log(`Reset trigger event: ${triggerEventDesc}`)\n    lockTrigger()\n    triggerReset('reset')\n\n    heightCalcMode = hcm\n  }\n\n  function sendMsg(height, width, triggerEvent, msg, targetOrigin) {\n    function setTargetOrigin() {\n      if (undefined === targetOrigin) {\n        targetOrigin = targetOriginDefault\n        return\n      }\n\n      log(`Message targetOrigin: ${targetOrigin}`)\n    }\n\n    function sendToParent() {\n      const size = `${height + offsetHeight}:${width + offsetWidth}`\n      const message = `${myID}:${size}:${triggerEvent}${undefined === msg ? '' : `:${msg}`}`\n\n      log(\n        `Sending message to host page (${message}) via ${sameDomian ? 'sameDomain' : 'postMessage'}`\n      )\n\n      if (sameDomian) {\n        window.parent.iFrameListener(msgID + message)\n        return\n      }\n\n      target.postMessage(msgID + message, targetOrigin)\n    }\n\n    if (sendPermit === true) {\n      setTargetOrigin()\n      sendToParent()\n    }\n  }\n\n  function receiver(event) {\n    const processRequestFromParent = {\n      init: function initFromParent() {\n        initMsg = event.data\n        target = event.source\n\n        init()\n        firstRun = false\n        setTimeout(() => {\n          initLock = false\n        }, eventCancelTimer)\n      },\n\n      reset() {\n        if (initLock) {\n          log('Page reset ignored by init')\n          return\n        }\n        log('Page size reset by host page')\n        triggerReset('resetPage')\n      },\n\n      resize() {\n        sendSize('resizeParent', 'Parent window requested size check')\n      },\n\n      moveToAnchor() {\n        inPageLinks.findTarget(getData())\n      },\n\n      inPageLink() {\n        this.moveToAnchor()\n      }, // Backward compatibility\n\n      pageInfo() {\n        const msgBody = getData()\n        if (onPageInfo) {\n          log(`PageInfoFromParent called from parent: ${msgBody}`)\n          onPageInfo(Object.freeze(JSON.parse(msgBody)))\n        } else {\n          // not expected, so cancel more messages\n          sendMsg(0, 0, 'pageInfoStop')\n        }\n        log(' --')\n      },\n\n      message() {\n        const msgBody = getData()\n\n        log(`onMessage called from parent: ${msgBody}`)\n        // eslint-disable-next-line sonarjs/no-extra-arguments\n        onMessage(JSON.parse(msgBody))\n        log(' --')\n      }\n    }\n\n    const isMessageForUs = () => msgID === `${event.data}`.slice(0, msgIdLen)\n\n    const getMessageType = () => event.data.split(']')[1].split(':')[0]\n\n    const getData = () => event.data.slice(event.data.indexOf(':') + 1)\n\n    const isMiddleTier = () =>\n      (!(typeof module !== 'undefined' && module.exports) &&\n        'iFrameResize' in window) ||\n      (window.jQuery !== undefined && 'iFrameResize' in window.jQuery.prototype)\n\n    // Test if this message is from a child below us. This is an ugly test, however, updating\n    // the message format would break backwards compatibility.\n    const isInitMsg = () => event.data.split(':')[2] in { true: 1, false: 1 }\n\n    function callFromParent() {\n      const messageType = getMessageType()\n\n      if (messageType in processRequestFromParent) {\n        processRequestFromParent[messageType]()\n        return\n      }\n\n      if (!isMiddleTier() && !isInitMsg()) {\n        warn(`Unexpected message (${event.data})`)\n      }\n    }\n\n    function processMessage() {\n      if (firstRun === false) {\n        callFromParent()\n        return\n      }\n\n      if (isInitMsg()) {\n        processRequestFromParent.init()\n        return\n      }\n\n      log(\n        `Ignored message of type \"${getMessageType()}\". Received before initialization.`\n      )\n    }\n\n    if (isMessageForUs()) {\n      processMessage()\n    }\n  }\n\n  // Normally the parent kicks things off when it detects the iFrame has loaded.\n  // If this script is async-loaded, then tell parent page to retry init.\n  function chkLateLoaded() {\n    if (document.readyState !== 'loading') {\n      window.parent.postMessage('[iFrameResizerChild]Ready', '*')\n    }\n  }\n\n  window.iFrameListener = (data) => receiver({ data, sameDomian: true })\n\n  addEventListener(window, 'message', receiver)\n  addEventListener(window, 'readystatechange', chkLateLoaded)\n  chkLateLoaded()\n\n  // TEST CODE START //\n\n  // Create test hooks\n  function mockMsgListener(msgObject) {\n    receiver(msgObject)\n    return win\n  }\n\n  try {\n    // eslint-disable-next-line no-restricted-globals\n    if (top?.document?.getElementById('banner')) {\n      win = {}\n\n      removeEventListener(window, 'message', receiver)\n\n      define([], () => mockMsgListener)\n    }\n  } catch (error) {\n    // do nothing\n  }\n\n  // TEST CODE END //\n})()\n"],"names":["undefined","window","BASE","SIZE_ATTR","checkVisibilityOptions","contentVisibilityAuto","opacityProperty","visibilityProperty","customCalcMethods","height","warn","getHeight","auto","width","getWidth","deprecatedResizeMethods","bodyOffset","bodyScroll","offset","documentElementOffset","documentElementScroll","documentElementBoundingClientRect","max","min","grow","lowestElement","eventCancelTimer","eventHandlersByName","hasCheckVisibility","heightCalcModeDefault","nonLoggableTriggerEvents","reset","resetPage","init","msgID","msgIdLen","length","resetRequiredMethods","resizeObserveTargets","widthCalcModeDefault","autoResize","bodyBackground","bodyMargin","bodyMarginStr","bodyObserver","bodyPadding","calculateHeight","calculateWidth","calcElements","firstRun","hasTags","heightCalcMode","initLock","initMsg","inPageLinks","isInit","logging","mouseEvents","myID","offsetHeight","offsetWidth","resizeFrom","resizeObserver","sameDomian","target","parent","targetOriginDefault","tolerance","triggerLocked","widthCalcMode","win","onMessage","onReady","onPageInfo","addEventListener","el","evt","func","options","removeEventListener","capitalizeFirstLetter","string","charAt","toUpperCase","slice","isDef","value","getElementName","id","nodeName","name","className","formatLogMsg","msg","join","log","console","advise","chrome","replaceAll","error","checkCrossDomain","strBool","str","data","split","Number","enable","readDataFromParent","location","href","readData","iFrameResizer","JSON","stringify","targetOrigin","heightCalculationMethod","widthCalculationMethod","setupCustomCalcMethods","calcMode","calcFunc","Object","constructor","readDataFromPage","setBodyStyle","attr","includes","chkCSS","setMargin","clearFix","document","createElement","style","clear","display","body","append","injectClearFixIntoBodyElement","setAutoHeight","setProperty","documentElement","stopInfiniteResizingOfIFrame","checkHeightMode","checkWidthMode","found","checkAttrs","querySelectorAll","forEach","removeAttribute","setAttribute","checkDeprecatedAttrs","setupCalcElements","parentIFrame","resize","startEventListeners","manageEventListeners","disconnect","sendMsg","close","getId","getPageInfo","callback","moveToAnchor","hash","findTarget","resetIFrame","scrollTo","x","y","scrollToOffset","sendMessage","setHeightCalculationMethod","setWidthCalculationMethod","setTargetOrigin","size","customHeight","customWidth","sendSize","sendMouse","e","type","screenY","screenX","addMouseListener","setupMouseEvents","getPagePosition","scrollLeft","scrollTop","getElementPosition","elPosition","getBoundingClientRect","pagePosition","parseInt","left","top","jumpToTarget","jumpPosition","hashData","decodeURIComponent","getElementById","getElementsByName","checkLocationHash","bindAnchors","setupLink","linkClicked","preventDefault","this","getAttribute","bindLocationHash","initCheck","setTimeout","enableInPageLinks","setupInPageLinks","manageTriggerEvent","add","eventName","handleEvent","eventType","passive","remove","method","taggedElements","getAllElements","checkCalcMode","calcModeDefault","modes","mutationObserved","mutations","addResizeObservers","createMutationObserver","observer","MutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","observe","setupBodyMutationObserver","ResizeObserver","resizeObserved","createResizeObservers","entries","checkPositionType","element","getComputedStyle","position","getAllNonStaticElements","filter","setupResizeObservers","flatMap","mutation","getMaxElement","side","Side","maxEl","elVal","len","maxVal","timer","performance","now","checkVisibility","getPropertyValue","logMsg","toPrecision","outer","outerHTML","toString","elementSnippet","getAllMeasurements","dimension","prevScrollSize","prevBoundingSize","getAutoSize","getDimension","autoOverflow","returnBoundingClientRect","boundingSize","scrollSize","isHeight","ceilBoundingSize","Math","ceil","floorBoundingSize","floor","getOffset","getAdjustedScroll","sizes","enabled","taggedElement","switchToAutoOverflow","marginTop","marginBottom","scrollHeight","custom","bottom","scrollWidth","right","rightMostElement","scroll","sizeIFrame","triggerEvent","triggerEventDesc","currentHeight","currentWidth","checkTolarance","a","b","abs","isSizeChangeDetected","lockTrigger","hidden","requestAnimationFrame","triggerReset","hcm","message","iFrameListener","postMessage","sendToParent","receiver","event","processRequestFromParent","source","getData","inPageLink","pageInfo","msgBody","freeze","parse","getMessageType","indexOf","isMiddleTier","module","exports","jQuery","prototype","isInitMsg","true","false","messageType","callFromParent","chkLateLoaded","readyState","mockMsgListener","msgObject","define"],"mappings":"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"}